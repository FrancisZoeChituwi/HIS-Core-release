(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e2514"],{"7dd5":function(e,t,n){"use strict";n.r(t);var r=n("7a23");function a(e,t,n,a,i,o){var u=Object(r["resolveComponent"])("his-standard-form");return Object(r["openBlock"])(),Object(r["createBlock"])(u,{fields:e.fields,activeField:e.activeField,onFinishAction:e.onFinish,skipSummary:!0,cancelDestinationPath:e.cancelDestination},null,8,["fields","activeField","onFinishAction","cancelDestinationPath"])}n("4160"),n("d81d"),n("159b");var i=n("9ab4"),o=n("d95e"),u=n("7920"),c=n("2706"),s=n("9283"),d=n("3d6c"),l=n("b5e4"),h=Object(r["defineComponent"])({components:{HisStandardForm:u["a"]},data:function(){return{activeField:"",fields:[],drugs:[],selectedDrugs:[],barcode:"",stockService:{}}},methods:{onFinish:function(e){return Object(i["b"])(this,void 0,void 0,(function(){var t,n,r,a,o,u;return Object(i["d"])(this,(function(i){switch(i.label){case 0:t=e.enter_batches,n=[],r=0,i.label=1;case 1:return r<t.length?(a=t[r].value,o={current_quantity:a["current_quantity"],reason:e.reason.value},[4,this.stockService.updateItem(a["pharmacy_batch_id"],o)]):[3,4];case 2:u=i.sent(),u||n.push("could not stock for "+t[r].shortName),i.label=3;case 3:return r++,[3,1];case 4:return 0===n.length?(Object(l["d"])("Stock succesfully updated"),this.$router.push("/")):Object(l["c"])("Could not save stock"),[2]}}))}))},getFields:function(){var e=this;return[{id:"date",helpText:"Verfication Date",type:o["b"].TT_FULL_DATE,validation:function(e){return c["a"].required(e)}},{id:"enter_batches",helpText:"Batch entry",type:o["b"].TT_BATCH_VERIFICATION,options:function(){return e.drugs},validation:function(e){return c["a"].required(e)}},{id:"reason",helpText:"Select reason",type:o["b"].TT_SELECT,validation:function(e){return c["a"].required(e)},options:function(){return[{label:"Monthly stock take",value:"Monthly stock take"},{label:"Audit",value:"Audit"},{label:"Adhoc (due to stock imbalance)",value:"Adhoc (due to stock imbalance)"},{label:"Supervision",value:"Supervision"}]}},{id:"verification_summary",helpText:"Summary",type:o["b"].TT_TABLE_VIEWER,options:function(t){return e.buildResults(t.enter_batches)},config:{hiddenFooterBtns:["Clear"]}}]},buildResults:function(e){var t=["Drug","Total units","Expiry date"],n=e.map((function(e){var t=e.value;return[t.shortName,t["current_quantity"],s["a"].toStandardHisDisplayFormat(t.expiry_date)]}));return[{label:"Confirm entry",value:"Table",other:{columns:t,rows:n}}]},prepDrugs:function(e){var t=[],n=this.barcode;return e.enter_batches.value.forEach((function(r){t.push({batch_number:r.batchNumber,items:[{barcode:n,drug_id:r.drugID,expiry_date:r.expiry,quantity:parseInt(r.tabs)*parseInt(r.tins),delivery_date:e.date.value}]})})),t},selectAll:function(e){return e.map((function(e){return e.isChecked=!0,e}))},formatDrugs:function(){return this.stockService.drugList().map((function(e){return{label:e.shortName,value:e}}))}},created:function(){this.stockService=new d["a"],this.fields=this.getFields(),this.drugs=this.formatDrugs()}}),b=n("d959"),p=n.n(b);const f=p()(h,[["render",a]]);t["default"]=f}}]);
//# sourceMappingURL=chunk-2d0e2514.b35d02cc.js.map