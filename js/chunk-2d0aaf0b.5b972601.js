(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0aaf0b"],{"12c7":function(t,e,i){"use strict";i.r(e);var n=i("7a23");function r(t,e,i,r,a,s){var o=Object(n["resolveComponent"])("his-standard-form");return Object(n["openBlock"])(),Object(n["createBlock"])(o,{skipSummary:!0,activeField:t.fieldComponent,onOnIndex:e[1]||(e[1]=function(e){return t.fieldComponent=""}),fields:t.fields},null,8,["activeField","fields"])}i("d81d"),i("b0c0"),i("d3b7"),i("ac1f"),i("466d");var a=i("9ab4"),s=i("2ef0"),o=i("d95e"),c=i("8a30"),u=i("23e6"),l=(i("4d63"),i("25f0"),i("841c"),i("1276"),i("1c74")),d=i("b89f"),f=i("d1ca"),b=function(t){function e(){var e=t.call(this)||this;return e.patientID=0,e.activePrefix="",e.dormantPrefix="",e}return Object(a["c"])(e,t),e.prototype.getActivePrx=function(){return this.activePrefix},e.prototype.getDormantPrx=function(){return this.dormantPrefix},e.prototype.getPatientID=function(){return this.patientID},e.prototype.setPatientID=function(t){this.patientID=t},e.prototype.formatNumber=function(t){var e=t.search(this.activePrefix)>=0?this.activePrefix:t.search(this.dormantPrefix)>=0?this.dormantPrefix:"";return e?t.substring(e.length,t.length):t},e.prototype.loadFilingPrefix=function(){return Object(a["b"])(this,void 0,void 0,(function(){var t,e,i,n;return Object(a["d"])(this,(function(r){switch(r.label){case 0:return[4,f["b"].filingNumberPrefix()];case 1:return t=r.sent(),t&&(e=t.split(","),i=e[0],n=e[1],this.activePrefix=i,this.dormantPrefix=n),[2]}}))}))},e.prototype.isActiveFilingNum=function(t){return!!t.match(new RegExp(this.activePrefix,"i"))},e.prototype.isDormantFilingNum=function(t){return!!t.match(new RegExp(this.dormantPrefix,"i"))},e.prototype.assignFilingNumber=function(){return Object(a["b"])(this,void 0,void 0,(function(){return Object(a["d"])(this,(function(t){return[2,l["d"].postJson("patients/"+this.patientID+"/filing_number",{})]}))}))},e.prototype.getFilingNumber=function(t){return Object(a["b"])(this,void 0,void 0,(function(){var e,i;return Object(a["d"])(this,(function(n){switch(n.label){case 0:return e=""+this.activePrefix+t,[4,l["d"].getJson("search/patients/by_identifier",{type_id:17,identifier:e})];case 1:return i=n.sent(),i?[2,i.map((function(t){var i=new u["a"](t);return{identifier:e,patient_id:i.getID(),given_name:i.getGivenName(),family_name:i.getFamilyName(),state:"N/A",appointment_date:""}}))]:[2,[]]}}))}))},e.prototype.archiveFilingNumber=function(){return l["d"].getJson("archive_active_filing_number",{patient_id:this.patientID})},e.prototype.archivePatient=function(t,e){return l["d"].postJson("swap_active_number",{primary_patient_id:this.patientID,secondary_patient_id:t,identifier:e})},e.prototype.getArchivingCandidates=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=10),l["d"].getJson("archiving_candidates",{page:t,page_size:e})},e.prototype.getPastFilingNumbers=function(){return l["d"].getJson("patients/"+this.patientID+"/past_filing_numbers")},e.prototype.printFilingNumber=function(){var t=new d["a"];return t.printLbl("patients/"+this.patientID+"/labels/filing_number")},e}(l["d"]),h=i("7920"),m=i("2706"),v=i("b5e4"),g=i("9283"),p=i("10be"),N=i("0fa1"),F=Object(n["defineComponent"])({components:{HisStandardForm:h["a"]},data:function(){return{service:{},patient:{},fieldComponent:"",fields:[],nextWorkflowRouteName:"",filingNumberAssignment:{}}},watch:{$route:{handler:function(t){var e=t.query,i=t.params;return Object(a["b"])(this,void 0,void 0,(function(){var t;return Object(a["d"])(this,(function(n){switch(n.label){case 0:return i&&i.patient_id?(this.service=new b,this.service.setPatientID(i.patient_id),t=this,[4,this.getPatient(i.patient_id)]):[3,3];case 1:return t.patient=n.sent(),[4,this.service.loadFilingPrefix()];case 2:n.sent(),n.label=3;case 3:return e?(this.fields=[this.getFilingNumberField(),this.getCandidateSelectionField(),this.getFilingNumberHistoryField()],"true"!==e.archive?[3,5]:[4,this.archiveFilingNumber()]):[3,8];case 4:return n.sent(),[2];case 5:return"true"!==e.assign?[3,7]:[4,this.onAssignFilingNumber()];case 6:n.sent(),n.label=7;case 7:"true"===e.trail&&(this.fieldComponent="view_filing_history"),e.next_workflow_task&&(this.nextWorkflowRouteName=e.next_workflow_task),n.label=8;case 8:return[2]}}))}))},immediate:!0,deep:!0}},methods:{toFID:function(t){return this.service.formatNumber(t)},onAssignFilingNumber:function(){return Object(a["b"])(this,void 0,void 0,(function(){var t;return Object(a["d"])(this,(function(e){switch(e.label){case 0:return[4,this.newFilingNumber()];case 1:return t=e.sent(),t?(this.filingNumberAssignment=t,this.fieldComponent="filing_number_management"):(this.fieldComponent="select_candidate_to_swap",Object(v["e"])("Out of filing numbers, Please select eligible candidate")),[2]}}))}))},newFilingNumber:function(){return Object(a["b"])(this,void 0,Promise,(function(){var t,e,i;return Object(a["d"])(this,(function(n){switch(n.label){case 0:return t={primary:{label:"Dormant → Active",value:this.patient.name,other:{activeNumber:this.patient.filingID?this.toFID(this.patient.filingID):"N/A",dormantNumber:"N/A"}},archived:{label:"Active → Dormant",value:"N/A",other:{activeNumber:"N/A",dormantNumber:"N/A"}}},this.service.isActiveFilingNum(this.patient.filingID)?[2,t]:[4,this.presentLoading()];case 1:return n.sent(),[4,this.service.assignFilingNumber()];case 2:return e=n.sent(),c["S"].dismiss(),Object(s["isEmpty"])(e)?[2]:(t.primary.other={activeNumber:this.toFID(e.new_identifier.identifier),dormantNumber:this.service.isDormantFilingNum(this.patient.filingID)?this.toFID(this.patient.filingID):"N/A"},Object(s["isEmpty"])(e.archived_identifier)?[3,4]:[4,this.getPatient(e.archived_identifier.patient_id)]);case 3:i=n.sent(),t.archived={label:"Active → Dormant",value:i.name,other:{activeNumber:this.toFID(e.archived_identifier.identifier),dormantNumber:this.toFID(e.new_identifier.identifier)}},n.label=4;case 4:return[2,t]}}))}))},swapExistingFilingNumbers:function(t){return Object(a["b"])(this,void 0,void 0,(function(){var e;return Object(a["d"])(this,(function(i){switch(i.label){case 0:return[4,this.service.archivePatient(t.patient_id,t.identifier)];case 1:return e=i.sent(),e?[2,{primary:{label:"Dormant → Active",value:this.patient.name,other:{activeNumber:this.toFID(e.active_number),dormantNumber:this.toFID(this.patient.filingID)||"N/A"}},archived:{label:"Active → Dormant",value:t.given_name+" "+t.family_name,other:{patientID:t.patient_id,activeNumber:this.toFID(e.dormant_number),dormantNumber:this.toFID(e.active_number)}}}]:[2]}}))}))},presentLoading:function(t){return void 0===t&&(t="Please wait..."),Object(a["b"])(this,void 0,void 0,(function(){var e;return Object(a["d"])(this,(function(i){switch(i.label){case 0:return[4,c["S"].create({message:t,backdropDismiss:!1})];case 1:return e=i.sent(),[4,e.present()];case 2:return i.sent(),[2]}}))}))},getPatient:function(t){return Object(a["b"])(this,void 0,Promise,(function(){var e,i;return Object(a["d"])(this,(function(n){switch(n.label){case 0:return[4,u["a"].findByID(t)];case 1:return e=n.sent(),e?(i=new u["a"](e),[2,{id:i.getID(),filingID:i.getFilingNumber(),name:i.getGivenName()+" "+i.getFamilyName()}]):[2,{}]}}))}))},archiveFilingNumber:function(){return Object(a["b"])(this,void 0,void 0,(function(){var t;return Object(a["d"])(this,(function(e){switch(e.label){case 0:return[4,this.presentLoading("Archiving filing number")];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,5,,6]),[4,this.service.archiveFilingNumber()];case 3:return e.sent(),[4,this.service.printFilingNumber()];case 4:return e.sent(),[3,6];case 5:return t=e.sent(),Object(v["c"])(t),[3,6];case 6:return[4,c["S"].dismiss()];case 7:return e.sent(),this.$router.back(),[2]}}))}))},filingNumberSearchKeypad:function(){return Object(a["b"])(this,void 0,void 0,(function(){var t,e;return Object(a["d"])(this,(function(i){switch(i.label){case 0:return[4,c["U"].create({component:p["a"],backdropDismiss:!1,cssClass:"keypad-modal",componentProps:{title:"Find Active number",strictNumbers:!1,onKeyPress:function(){}}})];case 1:return t=i.sent(),[4,t.present()];case 2:return i.sent(),[4,t.onDidDismiss()];case 3:return e=i.sent().data,[2,e]}}))}))},getArchivingCandidates:function(t){return void 0===t&&(t=0),Object(a["b"])(this,void 0,Promise,(function(){var e;return Object(a["d"])(this,(function(i){switch(i.label){case 0:return[4,this.service.getArchivingCandidates(t)];case 1:return e=i.sent(),[2,this.formatCandidateOptions(e)]}}))}))},formatCandidateOptions:function(t){var e=this;return t.map((function(t){return{label:t.given_name+" "+t.family_name+" ("+t.state+")",value:t.identifier,other:{data:t,list:[{label:"Filing #",value:e.toFID(t.identifier),style:{color:"green",fontWeight:"bold"}},{label:"Given name",value:t.given_name},{label:"Family name",value:t.family_name},{label:"Outcome",value:t.state.match(/trans/i)?"TO":t.state.match(/stop/i)?"Tx stopped":t.state},{label:"LAD",value:g["a"].toStandardHisDisplayFormat(t.appointment_date)}]}}}))},getFilingNumberHistoryField:function(){var t=this;return{id:"view_filing_history",type:o["b"].TT_TABLE_VIEWER,helpText:"Filing Number Trail",condition:function(){return!1},options:function(){return Object(a["b"])(t,void 0,void 0,(function(){var t,e,i,n=this;return Object(a["d"])(this,(function(r){switch(r.label){case 0:return t=["Status","Filing #","Date Created","Date voided"],[4,this.service.getPastFilingNumbers()];case 1:return e=r.sent(),i=e.map((function(t){var e=0===t.voided;return[e?"Active":"Voided",n.toFID(t.identifier),g["a"].toStandardHisDisplayFormat(t.date_created),e?"N/A":g["a"].toStandardHisDisplayFormat(t.date_voided)]})),[2,[{label:"Filing Number Trail",value:"Trail",other:{columns:t,rows:i}}]]}}))}))},config:{toolbarInfo:[{label:"Current filing #",value:this.toFID(this.patient.filingID)},{label:"Status",value:this.service.isActiveFilingNum(this.patient.filingID)?"Active":this.service.isDormantFilingNum(this.patient.filingID)?"Dormant":"N/A"}],hiddenFooterBtns:["Clear","Next","Back","Finish"],footerBtns:[{name:"Get filing #",slot:"end",state:{visible:{default:function(){return t.service.isDormantFilingNum(t.patient.filingID)}}},onClick:function(){return Object(a["b"])(t,void 0,void 0,(function(){return Object(a["d"])(this,(function(t){switch(t.label){case 0:return[4,this.onAssignFilingNumber()];case 1:return[2,t.sent()]}}))}))}}]}}},getCandidateSelectionField:function(){var t=this,e={},i=0,n="",r=[];return{id:"select_candidate_to_swap",type:o["b"].TT_CARD_SELECTOR,helpText:"Filing Number (Archive)",condition:function(){return!1},validation:function(t){return m["a"].required(t)},onload:function(t){return e=t},onValue:function(e){return Object(a["b"])(t,void 0,void 0,(function(){var t,i;return Object(a["d"])(this,(function(n){switch(n.label){case 0:return e?[4,Object(v["a"])("Do you want to archive "+e.value)]:[3,3];case 1:return t=n.sent(),t?[4,this.swapExistingFilingNumbers(e.other.data)]:[3,3];case 2:if(i=n.sent(),i)return this.filingNumberAssignment=i,this.fieldComponent="filing_number_management",[2,!0];n.label=3;case 3:return[2,!1]}}))}))},options:function(){return t.getArchivingCandidates()},config:{hiddenFooterBtns:["Clear","Back","Finish","Next"],footerBtns:[{name:"Reset",slot:"end",color:"warning",state:{visible:{default:function(){return!!n}}},onClick:function(){n="",e.listData=r,r=[]}},{name:"Specify",slot:"end",color:"success",onClick:function(){return Object(a["b"])(t,void 0,void 0,(function(){var t;return Object(a["d"])(this,(function(i){switch(i.label){case 0:return[4,this.filingNumberSearchKeypad()];case 1:return n=i.sent(),n?[4,this.service.getFilingNumber(n)]:[3,3];case 2:t=i.sent(),r=Object(a["f"])(e.listData),e.listData=this.formatCandidateOptions(t),i.label=3;case 3:return[2]}}))}))}},{name:"Previous batch",slot:"end",state:{visible:{default:function(){return!n}},disabled:{default:function(){return i<=0}}},onClick:function(){return Object(a["b"])(t,void 0,void 0,(function(){var t;return Object(a["d"])(this,(function(n){switch(n.label){case 0:return i-=1,t=e,[4,this.getArchivingCandidates(i)];case 1:return t.listData=n.sent(),[2]}}))}))}},{name:"Next batch",slot:"end",state:{visible:{default:function(){return!n}},disabled:{default:function(){return e.listData&&e.listData.length<=1}}},onClick:function(){return Object(a["b"])(t,void 0,void 0,(function(){var t;return Object(a["d"])(this,(function(n){switch(n.label){case 0:return i+=1,t=e,[4,this.getArchivingCandidates(i)];case 1:return t.listData=n.sent(),[2]}}))}))}}]}}},getFilingNumberField:function(){var t=this;return{id:"filing_number_management",type:o["b"].TT_FILING_NUMBER_VIEW,helpText:"Filing Number Management",onload:function(){return Object(a["b"])(t,void 0,void 0,(function(){return Object(a["d"])(this,(function(t){switch(t.label){case 0:return[4,this.service.printFilingNumber()];case 1:return[2,t.sent()]}}))}))},condition:function(){return!1},options:function(){return[t.filingNumberAssignment.primary,t.filingNumberAssignment.archived]},config:{hiddenFooterBtns:["Cancel","Clear","Next"],footerBtns:[{name:"Print #",slot:"start",onClick:function(){return Object(a["b"])(t,void 0,void 0,(function(){return Object(a["d"])(this,(function(t){return[2,this.service.printFilingNumber()]}))}))}},{name:"Print Dormant#",slot:"start",state:{visible:{default:function(){var e,i,n;return!!(null===(n=null===(i=null===(e=t.filingNumberAssignment)||void 0===e?void 0:e.archived)||void 0===i?void 0:i.other)||void 0===n?void 0:n.patientID)}}},onClick:function(){return Object(a["b"])(t,void 0,void 0,(function(){var t;return Object(a["d"])(this,(function(e){switch(e.label){case 0:return t=new b,t.setPatientID(this.filingNumberAssignment.archived.other.patientID),[4,t.printFilingNumber()];case 1:return e.sent(),[2]}}))}))}},{name:"Continue",color:"success",slot:"end",onClick:function(){return Object(N["b"])(t.patient.id,t.$router,t.$route)}}]}}}}}),D=i("d959"),_=i.n(D);const O=_()(F,[["render",r]]);e["default"]=O}}]);
//# sourceMappingURL=chunk-2d0aaf0b.5b972601.js.map