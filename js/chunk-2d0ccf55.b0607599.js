(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0ccf55"],{"4fc0":function(t,e,n){"use strict";n.r(e);var r=n("7a23");function i(t,e,n,i,s,a){var o=Object(r["resolveComponent"])("his-standard-form");return Object(r["openBlock"])(),Object(r["createBlock"])(o,{skipSummary:!0,cancelDestinationPath:t.cancelDestination,fields:t.fields},null,8,["cancelDestinationPath","fields"])}n("a623"),n("d81d"),n("b0c0"),n("d3b7"),n("25f0");var s=n("9ab4"),a=n("d95e"),o=n("b5e4"),u=(n("3ca3"),n("ddb0"),n("cc6f")),d=n("71c3"),c=function(t){function e(e,n){var r=t.call(this,e,54,n)||this;return r.drugHistory=[],r.currentDrugOrder=[],r}return Object(s["c"])(e,t),e.prototype.getDrugHistory=function(){return this.drugHistory},e.prototype.getCurrentOrder=function(){return this.currentDrugOrder},e.prototype.buildDispensations=function(t,e){return[{drug_order_id:t,date:this.date,quantity:e}]},e.prototype.saveDispensations=function(t){return u["a"].postJson("/dispensations",{dispensations:t,program_id:u["a"].getProgramID()})},e.prototype.voidOrder=function(t){return Object(s["b"])(this,void 0,void 0,(function(){return Object(s["d"])(this,(function(e){return[2,u["a"].void("/dispensations/"+t,{})]}))}))},e.prototype.loadDrugHistory=function(){return Object(s["b"])(this,void 0,void 0,(function(){var t;return Object(s["d"])(this,(function(e){switch(e.label){case 0:return[4,d["a"].getDrugOrderHistory(this.patientID)];case 1:return t=e.sent(),t&&(this.drugHistory=t),[2]}}))}))},e.prototype.loadCurrentDrugOrder=function(){return Object(s["b"])(this,void 0,void 0,(function(){var t,e;return Object(s["d"])(this,(function(n){switch(n.label){case 0:return[4,d["a"].getDrugOrders(this.patientID)];case 1:return t=n.sent(),t?(e=this,[4,Promise.all(t)]):[3,3];case 2:e.currentDrugOrder=n.sent(),n.label=3;case 3:return[2]}}))}))},e.prototype.calcCompletePack=function(t,e){var n=t.barcodes.sort((function(t,e){return t.tabs-e.tabs}));if(0==n.length||0==e)return e;for(var r=0;r<=n.length-1;r++)if(parseInt(n[r].tabs)>=e)return n[r].tabs;var i=parseInt(n[0].tabs),s=parseInt(n[n.length-1].tabs);while(s<e)s+=i;return s},e}(u["a"]),l=n("7365"),p=n("9283"),h=Object(r["defineComponent"])({mixins:[l["a"]],data:function(){return{dispensation:{}}},watch:{patient:{handler:function(t){return Object(s["b"])(this,void 0,void 0,(function(){return Object(s["d"])(this,(function(e){switch(e.label){case 0:return this.dispensation=new c(t.getID(),this.providerID),[4,this.dispensation.loadCurrentDrugOrder()];case 1:return e.sent(),[4,this.dispensation.loadDrugHistory()];case 2:return e.sent(),this.fields=this.getFields(),[2]}}))}))},deep:!0}},methods:{saveDispensations:function(t){var e=this.buildDispensations(t);return this.dispensation.saveDispensations(e)},buildDispensations:function(t){return this.dispensation.buildDispensations(t.other.order_id,t.value)},buildMedicationHistory:function(){return this.dispensation.getDrugHistory().sort((function(t,e){var n=new Date(t.order.start_date),r=new Date(e.order.start_date);return r-n})).map((function(t){return{medication:t.drug.name,date:p["a"].toStandardHisDisplayFormat(t.order.start_date),amount:t.quantity}}))},buildOrderOptions:function(){var t=this;return this.dispensation.getCurrentOrder().map((function(e){return{label:e.drug.name,value:e.quantity||0,other:{drug_id:e.drug.drug_id,order_id:e.order.order_id,amount_needed:t.calculateCompletePack(e)}}}))},getPackSizesRows:function(t,e){var n=this.dispensation.getDrugPackSizes(t);return n.map((function(t){var n=e>0?e/t:"-";return[t,n,0,0]}))},calculateCompletePack:function(t){var e=parseFloat(t.amount_needed)-(t.quantity||0),n=this.dispensation.calcCompletePack(t,e);return n<0?0:n},isDoneDispensing:function(t){return t.map((function(t){return 0!=t.value})).every(Boolean)},isValidDispensation:function(t){return Object(s["b"])(this,void 0,void 0,(function(){var e,n,r,i;return Object(s["d"])(this,(function(s){switch(s.label){case 0:return e=!0,n=parseInt(t.value.toString()),r=t.other["amount_needed"],i=n/r*100,i>110?[4,Object(o["a"])("Are you sure you want to dispense over 110% of the prescribed pill count?")]:[3,2];case 1:e=s.sent(),s.label=2;case 2:return i<100?[4,Object(o["a"])("Are you sure you want to dispense less than 100% of the prescribe amount?")]:[3,4];case 3:e=s.sent(),s.label=4;case 4:return[2,e]}}))}))},getFields:function(){var t=this;return[{id:"dispenses",helpText:"Dispensation",type:a["b"].TT_DRUG_DISPENSER,onValueUpdate:function(e,n){return Object(s["b"])(t,void 0,void 0,(function(){return Object(s["d"])(this,(function(t){switch(t.label){case 0:return-1!=e.value&&this.isDoneDispensing(n)?[2,this.gotoPatientDashboard()]:(e.other["amount_needed"]=0,[4,this.dispensation.loadCurrentDrugOrder()]);case 1:return t.sent(),[2,this.buildOrderOptions()]}}))}))},onValue:function(e,n){return Object(s["b"])(t,void 0,void 0,(function(){var t,r,i;return Object(s["d"])(this,(function(s){switch(s.label){case 0:return-1!==e.value?[3,2]:[4,this.dispensation.voidOrder(e.other.order_id)];case 1:return t=s.sent(),[2,!!t];case 2:return n?[3,4]:[4,this.isValidDispensation(e)];case 3:if(r=s.sent(),!r)return[2,!1];s.label=4;case 4:return[4,this.saveDispensations(e)];case 5:return i=s.sent(),i?[2,!0]:(Object(o["e"])("Unable to save dispensation"),[2,!1])}}))}))},config:{medicationHistory:this.buildMedicationHistory(),toolbarInfo:[{label:"Name",value:this.patient.getFullName()},{label:"Gender",value:this.patient.getGender()},{label:"Date Of Birth",value:p["a"].toStandardHisDisplayFormat(this.patient.getBirthdate())}],hiddenFooterBtns:["Clear","Finish"]},options:function(){return t.buildOrderOptions()}}]}}}),b=n("d959"),f=n.n(b);const v=f()(h,[["render",i]]);e["default"]=v}}]);
//# sourceMappingURL=chunk-2d0ccf55.b0607599.js.map