(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0d5c2c"],{7052:function(e,t,n){"use strict";n.r(t);var r=n("7a23");function a(e,t,n,a,i,o){var c=Object(r["resolveComponent"])("his-standard-form");return Object(r["openBlock"])(),Object(r["createBlock"])(c,{fields:e.fields,activeField:e.activeField,onFinishAction:e.onFinish,skipSummary:!0,cancelDestinationPath:e.cancelDestination},null,8,["fields","activeField","onFinishAction","cancelDestinationPath"])}n("99af"),n("4160"),n("d81d"),n("159b");var i=n("5530"),o=(n("96cf"),n("1da1")),c=n("d95e"),u=n("7920"),s=n("2706"),d=n("9283"),l=n("3d6c"),p=n("b5e4"),h=n("e86e"),f=Object(r["defineComponent"])({components:{HisStandardForm:u["a"]},data:function(){return{activeField:"",fields:[],drugs:[],selectedDrugs:[],barcode:"",stockService:{}}},methods:{onFinish:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var r,a,o,c,u,s,d,h,f,b;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r=e.enter_batches,a=[],o=0;case 3:if(!(o<r.length)){n.next=24;break}if(c=r[o].value,u=l["a"].getPackSize(c.drug_id),s=u*c.tins,d={},h={reallocation_code:c.authorization,quantity:s,reason:e.reasons.value},"Relocations"!==e.task.value){n.next=17;break}return d["location_id"]=e.relocation_location.value,n.next=13,t.stockService.relocateItems(c.pharmacy_batch_id,Object(i["a"])(Object(i["a"])({},h),d));case 13:f=n.sent,f||a.push("Could not save record for"+l["a"].getShortName(c.drug_id)),n.next=21;break;case 17:return n.next=19,t.stockService.disposeItems(c.pharmacy_batch_id,Object(i["a"])(Object(i["a"])({},h),d));case 19:b=n.sent,b||a.push("Could not save record for"+l["a"].getShortName(c.drug_id));case 21:o++,n.next=3;break;case 24:0===a.length?(Object(p["d"])("Stock succesfully moved"),t.$router.push("/")):Object(p["c"])("".concat(a.length," items could not be moved"));case 25:case"end":return n.stop()}}),n)})))()},getFields:function(){var e=this;return[{id:"task",helpText:"Select task",type:c["b"].TT_SELECT,validation:function(e){return s["a"].required(e)},options:function(){return[{label:"Relocations",value:"Relocations"},{label:"Disposal",value:"Disposal"}]}},{id:"relocation_location",helpText:"Destination",type:c["b"].TT_SELECT,validation:function(e){return s["a"].required(e)},condition:function(e){return"Relocations"===e.task.value},options:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(h["b"])(t)},computedValue:function(e){return e.label},config:{showKeyboard:!0,isFilterDataViaApi:!0}},{id:"date",helpText:"Set date",type:c["b"].TT_FULL_DATE,validation:function(e){return s["a"].required(e)}},{id:"select drugs",helpText:"Select drugs",type:c["b"].TT_MULTIPLE_SELECT,requireNext:!0,validation:function(e){return s["a"].required(e)},options:function(){return e.getItems()},unload:function(t){return e.selectedDrugs=t}},{id:"enter_batches",helpText:"Batch entry",type:c["b"].TT_BATCH_MOVEMENT,options:function(){return e.selectedDrugs},validation:function(e){return s["a"].required(e)}},{id:"reasons",helpText:"Select reason",type:c["b"].TT_SELECT,validation:function(e){return s["a"].required(e)},options:function(t){return e.getReasons(t)}},{id:"summary",helpText:"Summary",type:c["b"].TT_TABLE_VIEWER,options:function(t){return e.buildResults(t.enter_batches)},config:{hiddenFooterBtns:["Clear"]}}]},buildResults:function(e){var t=["Drug","Total units","Expiry date","Authorization code"],n=e.map((function(e){var t=e.value;return[l["a"].getShortName(t.drug_id),t.tins,d["a"].toStandardHisDisplayFormat(t.expiry),t.authorization]}));return[{label:"Confirm entry",value:"Table",other:{columns:t,rows:n}}]},prepDrugs:function(e){var t=[],n=this.barcode;return e.enter_batches.value.forEach((function(r){t.push({batch_number:r.batchNumber,items:[{barcode:n,drug_id:r.drugID,expiry_date:r.expiry,quantity:parseInt(r.tabs)*parseInt(r.tins),delivery_date:e.date.value}]})})),t},selectAll:function(e){return e.map((function(e){return e.isChecked=!0,e}))},getItems:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.stockService.getItems();case 2:return n=t.sent,t.abrupt("return",e.formatDrugs(n));case 4:case"end":return t.stop()}}),t)})))()},mapVal:function(e){return e.map((function(e){return{label:e,value:e}}))},getReasons:function(e){return"Relocations"===e.task.value?this.mapVal(["Transfer to another facility/relocation","For trainings"]):this.mapVal(["Expired","Damaged","For trainings"])},formatDrugs:function(e){return e.map((function(e){return{label:"".concat(l["a"].getShortName(e.drug_id)," (").concat(l["a"].getPackSize(e.drug_id),") Expiry date: ").concat(d["a"].toStandardHisDisplayFormat(e.expiry_date)),value:e}}))}},created:function(){this.stockService=new l["a"],this.fields=this.getFields()}}),b=n("d959"),m=n.n(b);const v=m()(f,[["render",a]]);t["default"]=v}}]);
//# sourceMappingURL=chunk-2d0d5c2c.12119d11.js.map