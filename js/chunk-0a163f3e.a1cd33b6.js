(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0a163f3e"],{"13c2":function(e,t,n){"use strict";n.r(t);var r=n("7a23");function o(e,t,n,o,c,i){var a=Object(r["resolveComponent"])("his-standard-form");return Object(r["openBlock"])(),Object(r["createBlock"])(a,{cancelDestinationPath:e.cancelDestination,fields:e.fields,activeField:e.activeField,onFinishAction:e.onSubmit},null,8,["cancelDestinationPath","fields","activeField","onFinishAction"])}n("4de4"),n("d81d"),n("b0c0"),n("07ac");var c=n("9ab4"),i=n("9441"),a=n("7365"),u=n("2706"),s=n("d95e"),l=n("2ef0"),d=n("cc6f"),b=n("71c3"),f={1:"OD",2:"BD",3:"TDS",4:"QID"},p=[{drug_id:236,duration:3,tabs:6,name:"Lumefantrine + Arthemether 1 x 6",dose_strength:1,units:"tabs",frequency:2},{drug_id:237,duration:3,tabs:12,name:"Lumefantrine + Arthemether 2 x 6",dose_strength:2,units:"tabs",frequency:2},{drug_id:238,duration:3,tabs:18,name:"Lumefantrine + Arthemether 3 x 6",dose_strength:3,units:"tabs",frequency:2},{drug_id:239,duration:3,tabs:24,name:"Lumefantrine + Arthemether 4 x 6",dose_strength:4,units:"tabs",frequency:2}],O=function(e){function t(t,n){var r=e.call(this,t,25,n)||this;return r.drugs=[],r}return Object(c["c"])(t,e),t.prototype.loadDrugs=function(e){return void 0===e&&(e=""),Object(c["b"])(this,void 0,void 0,(function(){var n;return Object(c["d"])(this,(function(r){switch(r.label){case 0:return n=this,[4,t.getJson("drugs",{page_size:1e6,name:e})];case 1:return n.drugs=r.sent(),[2]}}))}))},t.prototype.getDrugOptions=function(){return Object(l["isEmpty"])(this.drugs)?[]:this.drugs.map((function(e){return{label:e.name,value:e.name,other:e}}))},t.prototype.hasMalaria=function(){return Object(c["b"])(this,void 0,void 0,(function(){var e,t;return Object(c["d"])(this,(function(n){switch(n.label){case 0:return[4,this.getMalariaTestResult()];case 1:return e=n.sent(),e?[2,!0]:[4,this.getMalariaDiagnosis()];case 2:return t=n.sent(),t?[2,!0]:[2,!1]}}))}))},t.prototype.getMalariaTestResult=function(){return Object(c["b"])(this,void 0,void 0,(function(){var e;return Object(c["d"])(this,(function(t){switch(t.label){case 0:return[4,d["a"].getFirstValueCoded(this.patientID,"Malaria Test Result")];case 1:return e=t.sent(),e?[2,e]:[4,d["a"].getFirstValueText(this.patientID,"Malaria Test Result")];case 2:return e=t.sent(),e?[2,e]:[2,null]}}))}))},t.prototype.getMalariaDiagnosis=function(){return Object(c["b"])(this,void 0,void 0,(function(){return Object(c["d"])(this,(function(e){return[2,d["a"].getFirstValueCoded(this.patientID,"Malaria")]}))}))},t.prototype.createDrugOrder=function(e){return b["a"].create({encounter_id:this.encounterID,drug_orders:e})},t}(d["a"]),v=n("fe70"),j=(n("b64b"),Object(r["withScopeId"])("data-v-586626f5"));Object(r["pushScopeId"])("data-v-586626f5");var m=Object(r["createTextVNode"])("Complete prescription details"),h={class:"side-title"},g=Object(r["createTextVNode"])(" Close "),y=Object(r["createTextVNode"])("Save ");Object(r["popScopeId"])();var _=j((function(e,t,n,o,c,i){var a=Object(r["resolveComponent"])("ion-title"),u=Object(r["resolveComponent"])("ion-toolbar"),s=Object(r["resolveComponent"])("ion-header"),l=Object(r["resolveComponent"])("ion-label"),d=Object(r["resolveComponent"])("ion-item"),b=Object(r["resolveComponent"])("ion-list"),f=Object(r["resolveComponent"])("ion-col"),p=Object(r["resolveComponent"])("frequency-card"),O=Object(r["resolveComponent"])("ion-row"),v=Object(r["resolveComponent"])("interval-keyboard"),_=Object(r["resolveComponent"])("ion-grid"),C=Object(r["resolveComponent"])("ion-content"),k=Object(r["resolveComponent"])("ion-button"),D=Object(r["resolveComponent"])("ion-footer");return Object(r["openBlock"])(),Object(r["createBlock"])(r["Fragment"],null,[Object(r["createVNode"])(s,null,{default:j((function(){return[Object(r["createVNode"])(u,null,{default:j((function(){return[Object(r["createVNode"])(a,null,{default:j((function(){return[m]})),_:1})]})),_:1})]})),_:1}),Object(r["createVNode"])(C,{style:{overflowY:"hidden",background:"grey"}},{default:j((function(){return[Object(r["createVNode"])(_,null,{default:j((function(){return[Object(r["createVNode"])(O,null,{default:j((function(){return[Object(r["createVNode"])(f,{size:"4"},{default:j((function(){return[Object(r["createVNode"])(b,{style:{overflowY:"auto",height:"78vh",borderRight:"solid 1px #ccc"}},{default:j((function(){return[(Object(r["openBlock"])(!0),Object(r["createBlock"])(r["Fragment"],null,Object(r["renderList"])(e.drugs,(function(t,n){return Object(r["openBlock"])(),Object(r["createBlock"])(d,{key:t,detail:!0,onClick:function(){return e.activeIndex=n},color:e.activeIndex===n?"light":""},{default:j((function(){return[Object(r["createVNode"])(l,null,{default:j((function(){return[Object(r["createTextVNode"])(Object(r["toDisplayString"])(t.name),1)]})),_:2},1024)]})),_:2},1032,["onClick","color"])})),128))]})),_:1})]})),_:1}),Object(r["createVNode"])(f,{style:{overflowY:"auto",height:"78vh"}},{default:j((function(){return[e.activeIndex>=0?(Object(r["openBlock"])(),Object(r["createBlock"])(r["Fragment"],{key:0},[Object(r["createVNode"])("div",h,Object(r["toDisplayString"])(e.instructions),1),Object(r["createVNode"])(O,{class:"frequencies"},{default:j((function(){return[(Object(r["openBlock"])(!0),Object(r["createBlock"])(r["Fragment"],null,Object(r["renderList"])(Object.keys(e.frequencies),(function(t){return Object(r["openBlock"])(),Object(r["createBlock"])(f,{key:t},{default:j((function(){return[Object(r["createVNode"])(p,{title:t,status:e.frequencies[t],onClick:function(n){return e.setFrequency(t)}},null,8,["title","status","onClick"])]})),_:2},1024)})),128))]})),_:1}),Object(r["createVNode"])(v,{unit:"days",title:"Select Duration",onOnValue:e.setDuration},null,8,["onOnValue"])],64)):Object(r["createCommentVNode"])("",!0)]})),_:1})]})),_:1})]})),_:1})]})),_:1}),Object(r["createVNode"])(D,null,{default:j((function(){return[Object(r["createVNode"])(u,null,{default:j((function(){return[Object(r["createVNode"])(k,{onClick:e.closeModal,slot:"start",color:"danger",style:{"margin-left":"1rem"}},{default:j((function(){return[g]})),_:1},8,["onClick"]),Object(r["createVNode"])(k,{onClick:e.savePrescriptions,slot:"end",style:{"margin-right":"1rem"}},{default:j((function(){return[y]})),_:1},8,["onClick"])]})),_:1})]})),_:1})],64)})),C=n("8a30"),k=Object(r["withScopeId"])("data-v-0dd8dfe4"),D=k((function(e,t,n,o,c,i){var a=Object(r["resolveComponent"])("ion-card-subtitle"),u=Object(r["resolveComponent"])("ion-card-content"),s=Object(r["resolveComponent"])("ion-card");return Object(r["openBlock"])(),Object(r["createBlock"])(s,{class:["his-card clickable",{active:e.status}]},{default:k((function(){return[Object(r["createVNode"])("img",{src:e.icon,alt:e.title,height:"65"},null,8,["src","alt"]),Object(r["createVNode"])(u,null,{default:k((function(){return[Object(r["createVNode"])(a,{color:e.status?"primary":""},{default:k((function(){return[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.cardTitle),1)]})),_:1},8,["color"])]})),_:1})]})),_:1},8,["class"])})),I=n("ecc5"),V=Object(r["defineComponent"])({props:{title:{type:String,required:!0},status:{type:Boolean,default:!1}},components:{IonCard:C["f"],IonCardContent:C["g"],IonCardSubtitle:C["i"]},setup:function(e){var t=Object(r["computed"])((function(){return I["a"].capitalizeFirstLetter(e.title)})),n=Object(r["computed"])((function(){return"/assets/images/prescription/"+e.title+".png"}));return{cardTitle:t,icon:n}}}),N=(n("3b8e"),n("d959")),S=n.n(N);const q=S()(V,[["render",D],["__scopeId","data-v-0dd8dfe4"]]);var w=q,F=Object(r["withScopeId"])("data-v-5bd3374e"),T=F((function(e,t,n,o,c,i){var a=Object(r["resolveComponent"])("ion-label"),u=Object(r["resolveComponent"])("ion-item"),s=Object(r["resolveComponent"])("ion-list"),l=Object(r["resolveComponent"])("ion-col"),d=Object(r["resolveComponent"])("his-keyboard"),b=Object(r["resolveComponent"])("ion-row");return Object(r["openBlock"])(),Object(r["createBlock"])(b,{class:"ion-margin-vertical border"},{default:F((function(){return[Object(r["createVNode"])(l,{size:"4"},{default:F((function(){return[Object(r["createVNode"])(s,null,{default:F((function(){return[Object(r["createVNode"])(u,null,{default:F((function(){return[Object(r["createVNode"])(a,null,{default:F((function(){return[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.title),1)]})),_:1})]})),_:1}),(Object(r["openBlock"])(!0),Object(r["createBlock"])(r["Fragment"],null,Object(r["renderList"])(e.ranges,(function(t,n){return Object(r["openBlock"])(),Object(r["createBlock"])(u,{key:t,color:e.activeIndex===n?"light":"",detail:!0,onClick:function(n){return e.generateKeypad(t)}},{default:F((function(){return[Object(r["createVNode"])(a,null,{default:F((function(){return[Object(r["createTextVNode"])(Object(r["toDisplayString"])(t.start+" - "+t.end+" "+e.unit),1)]})),_:2},1024)]})),_:2},1032,["color","onClick"])})),128))]})),_:1})]})),_:1}),e.keyboard?(Object(r["openBlock"])(),Object(r["createBlock"])(l,{key:0},{default:F((function(){return[Object(r["createVNode"])(d,{kbConfig:e.keyboard,onKeyPress:e.onKeyPress,disabled:!1,style:{border:"0"}},null,8,["kbConfig","onKeyPress"])]})),_:1})):Object(r["createCommentVNode"])("",!0)]})),_:1})})),x=(n("c740"),n("db10")),B=Object(r["defineComponent"])({props:{unit:{type:String,default:""},title:{type:String,default:"Select Numbers"}},components:{HisKeyboard:x["a"],IonRow:C["F"],IonCol:C["m"],IonList:C["w"],IonItem:C["u"],IonLabel:C["v"]},emits:["onValue"],setup:function(e,t){var n=t.emit,o=Object(r["ref"])([{start:1,end:20},{start:21,end:40},{start:41,end:60},{start:61,end:80}]),c=Object(r["ref"])(0),i=Object(r["ref"])(),a=function(e){return n("onValue",e)},u=function(e){for(var t=[[]],n=0,r=0,a=e.start;a<=e.end;a++)r>4&&(++n,t[n]=[],r=0),t[n].push(""+a),++r;i.value=[t,[]],c.value=o.value.findIndex((function(t){return t.start===e.start}))};return Object(r["onMounted"])((function(){return u(o.value[0])})),{keyboard:i,onKeyPress:a,generateKeypad:u,ranges:o,activeIndex:c}}});n("8bc1");const M=S()(B,[["render",T],["__scopeId","data-v-5bd3374e"]]);var L=M,P=n("b5e4"),E=Object(r["defineComponent"])({name:"PrescriptionModal",props:{prescribedDrugs:{type:Object,required:!0}},setup:function(e){var t=Object(r["ref"])(-1),n=Object(r["computed"])((function(){return e.prescribedDrugs.map((function(e){var t=e.other;return t.duration=0,t.frequency={morning:!1,noon:!1,evening:!1,night:!1},t}))})),o=function(e){return Object.values(e).filter((function(e){return e})).length},c=Object(r["computed"])((function(){if(t.value<0)return"";var e=n.value[t.value].name,r=o(n.value[t.value].frequency),c=n.value[t.value].duration;return e+", "+r+" time(s) a day, for "+c+" day(s)"})),i=Object(r["computed"])((function(){return t.value<0?{}:n.value[t.value].frequency})),a=function(e){n.value[t.value].frequency[e]=!n.value[t.value].frequency[e]},u=function(e){n.value[t.value].duration=parseInt(e)},s=function(){for(var e=0,t=n.value;e<t.length;e++){var r=t[e],c=o(r.frequency),i=r.duration;if(!c||!i)return Object(P["e"])("complete prescription details for "+r.name),!1}return!0},l=function(){s()&&C["U"].dismiss(n.value)},d=function(){return C["U"].dismiss()};return{drugs:n,activeIndex:t,instructions:c,frequencies:i,closeModal:d,setFrequency:a,setDuration:u,savePrescriptions:l}},components:{IonContent:C["n"],IonButton:C["d"],IonHeader:C["q"],IonTitle:C["M"],IonToolbar:C["N"],IonLabel:C["v"],IonList:C["w"],IonItem:C["u"],IonRow:C["F"],FrequencyCard:w,IntervalKeyboard:L}});n("e987");const K=S()(E,[["render",_],["__scopeId","data-v-586626f5"]]);var R=K,A=n("9283"),z=Object(r["defineComponent"])({components:{HisStandardForm:i["a"]},mixins:[a["a"]],data:function(){return{activeField:"",prescriptionService:{},hasMalaria:!1,drugOrders:[]}},watch:{ready:{handler:function(e){return Object(c["b"])(this,void 0,void 0,(function(){var t;return Object(c["d"])(this,(function(n){switch(n.label){case 0:return e?(this.prescriptionService=new O(this.patientID,this.providerID),[4,this.prescriptionService.loadDrugs()]):[3,3];case 1:return n.sent(),t=this,[4,this.prescriptionService.hasMalaria()];case 2:t.hasMalaria=n.sent(),this.fields=this.getFields(),n.label=3;case 3:return[2]}}))}))},immediate:!0,deep:!0}},methods:{onSubmit:function(){return Object(c["b"])(this,void 0,void 0,(function(){var e,t;return Object(c["d"])(this,(function(n){switch(n.label){case 0:return[4,this.prescriptionService.createEncounter()];case 1:return e=n.sent(),e?[4,this.prescriptionService.createDrugOrder(this.drugOrders)]:[2,Object(P["e"])("Unable to create treatment encounter")];case 2:return t=n.sent(),t?(Object(P["d"])("Drug order has been created"),this.nextTask(),[2]):[2,Object(P["e"])("Unable to create drug orders!")]}}))}))},getPrescriptionDetails:function(e){return Object(c["b"])(this,void 0,void 0,(function(){var t,n;return Object(c["d"])(this,(function(r){switch(r.label){case 0:return[4,v["g"].create({component:R,backdropDismiss:!1,cssClass:"large-modal",componentProps:{prescribedDrugs:e}})];case 1:return t=r.sent(),t.present(),[4,t.onDidDismiss()];case 2:return n=r.sent().data,[2,n]}}))}))},getFrequencyCount:function(e){return Object.values(e).filter((function(e){return e})).length},calculateExpireDate:function(e,t){var n=new Date(e);return n.setDate(n.getDate()+t),A["a"].toStandardHisFormat(n)},mapToOrders:function(e){var t=this;return e.map((function(e){var n=O.getSessionDate(),r="number"===typeof e.frequency?e.frequency:t.getFrequencyCount(e.frequency),o=f[r];return{drug_inventory_id:e.drug_id,equivalent_daily_dose:e.dose_strength*r,start_date:n,auto_expire_date:t.calculateExpireDate(n,e.duration),units:e.units,instructions:e.name+": "+r+" "+o+" for "+e.duration,dose:e.dose_strength,frequency:o}}))},getFields:function(){var e=this;return[{id:"drugs",helpText:"Select drugs",type:s["b"].TT_MULTIPLE_SELECT,validation:function(e){return u["a"].required(e)},options:function(){return e.prescriptionService.getDrugOptions()},onload:function(){return e.activeField=""},beforeNext:function(t){return Object(c["b"])(e,void 0,void 0,(function(){var e;return Object(c["d"])(this,(function(n){switch(n.label){case 0:return[4,this.getPrescriptionDetails(t)];case 1:return e=n.sent(),Object(l["isEmpty"])(e)?[2,!1]:(this.drugOrders=this.mapToOrders(e),[2,!0])}}))}))},config:{showKeyboard:!0,footerBtns:[{name:"Predefined Malaria Drugs",color:"primary",size:"large",visible:!1,slot:"end",onClick:function(){return Object(c["b"])(e,void 0,void 0,(function(){var e;return Object(c["d"])(this,(function(t){switch(t.label){case 0:return this.hasMalaria&&(this.activeField="malaria_drugs"),[4,Object(P["a"])("Patient has no malaria. Do you still want to prescribe anti malaria drugs?")];case 1:return e=t.sent(),e&&(this.activeField="malaria_drugs"),[2]}}))}))}}]}},{id:"malaria_drugs",helpText:"select Malaria Drugs",validation:function(e){return u["a"].required(e)},type:s["b"].TT_SELECT,condition:function(){return"malaria_drugs"===e.activeField},onValue:function(t){return!Object(l["isEmpty"])(t)&&(e.drugOrders=e.mapToOrders([t.other]),!0)},options:function(){return p.map((function(e){return{label:e.name+", "+e.frequency+" time(s) a day, for "+e.duration+" days",value:e.name,other:e}}))}}]}}});const U=S()(z,[["render",o]]);t["default"]=U},"3b8e":function(e,t,n){"use strict";n("76ba")},"60f9":function(e,t,n){},"76ba":function(e,t,n){},"8bc1":function(e,t,n){"use strict";n("60f9")},9157:function(e,t,n){},e987:function(e,t,n){"use strict";n("9157")}}]);
//# sourceMappingURL=chunk-0a163f3e.a1cd33b6.js.map