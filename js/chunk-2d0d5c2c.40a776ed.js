(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0d5c2c"],{7052:function(e,t,n){"use strict";n.r(t);var r=n("7a23");function a(e,t,n,a,i,o){var c=Object(r["resolveComponent"])("his-standard-form");return Object(r["openBlock"])(),Object(r["createBlock"])(c,{fields:e.fields,activeField:e.activeField,onFinishAction:e.onFinish,skipSummary:!0,cancelDestinationPath:e.cancelDestination},null,8,["fields","activeField","onFinishAction","cancelDestinationPath"])}n("99af"),n("a623"),n("4de4"),n("4160"),n("a15b"),n("d81d"),n("d3b7"),n("159b"),n("ddb0");var i=n("9ab4"),o=n("d95e"),c=n("7920"),s=n("2706"),u=n("9283"),l=n("3d6c"),d=n("b5e4"),f=n("e86e"),b=n("1c74"),h=n("2ef0"),p=Object(r["defineComponent"])({components:{HisStandardForm:c["a"]},data:function(){return{activeField:"",fields:[],drugs:[],selectedDrugs:[],barcode:"",stockService:{}}},methods:{onFinish:function(e){return Object(i["b"])(this,void 0,void 0,(function(){var t,n,r,a,o,c,s,u,f,p;return Object(i["d"])(this,(function(v){switch(v.label){case 0:t=e.enter_batches,n=[],r=0,v.label=1;case 1:if(!(r<t.length))return[3,9];a=t[r].value,o=l["a"].getPackSize(a.drug_id),c=o*a.tins,s={},u={reallocation_code:a.authorization,quantity:c,reason:e.reasons.value},v.label=2;case 2:return v.trys.push([2,7,,8]),"Relocations"!==e.task.value?[3,4]:(s["location_id"]=e.relocation_location.value,[4,this.stockService.relocateItems(a.pharmacy_batch_id,Object(i["a"])(Object(i["a"])({},u),s))]);case 3:return f=v.sent(),f||n.push("Could not save record for"+l["a"].getShortName(a.drug_id)),[3,6];case 4:return[4,this.stockService.disposeItems(a.pharmacy_batch_id,Object(i["a"])(Object(i["a"])({},u),s))];case 5:f=v.sent(),f||n.push("Could not save record for"+l["a"].getShortName(a.drug_id)),v.label=6;case 6:return[3,8];case 7:return p=v.sent(),p instanceof b["a"]&&!Object(h["isEmpty"])(p.errors)?n=n.concat(p.errors):n.push(p),console.log(p),[3,8];case 8:return r++,[3,1];case 9:return 0===n.length?(Object(d["d"])("Stock succesfully moved"),this.$router.push("/")):Object(d["c"])(""+n.join(",")),[2]}}))}))},getFields:function(){var e=this;return[{id:"task",helpText:"Select task",type:o["b"].TT_SELECT,validation:function(e){return s["a"].required(e)},options:function(){return[{label:"Relocations",value:"Relocations"},{label:"Disposal",value:"Disposal"}]}},{id:"relocation_location",helpText:"Destination",type:o["b"].TT_SELECT,validation:function(e){return s["a"].required(e)},condition:function(e){return"Relocations"===e.task.value},options:function(e,t){return void 0===t&&(t=""),Object(f["b"])(t)},computedValue:function(e){return e.label},config:{showKeyboard:!0,isFilterDataViaApi:!0}},{id:"date",dynamicHelpText:function(e){return"Date of "+e.task.label},helpText:"Set date",type:o["b"].TT_FULL_DATE,validation:function(e){return s["a"].required(e)}},{id:"select drugs",helpText:"Select drugs",type:o["b"].TT_MULTIPLE_SELECT,requireNext:!0,validation:function(e){return s["a"].required(e)},options:function(t,n){return Object(i["b"])(e,void 0,void 0,(function(){var e;return Object(i["d"])(this,(function(t){switch(t.label){case 0:return[4,this.getItems()];case 1:return e=t.sent(),[2,e.map((function(e){return e.isChecked=n.filter((function(t){return t.label===e.label})).length>=1,e}))]}}))}))},unload:function(t){return e.selectedDrugs=t}},{id:"enter_batches",helpText:"Batch entry",type:o["b"].TT_BATCH_MOVEMENT,beforeNext:function(e,t,n,r){var a=r.currentFieldContext,i=function(e){return e.map((function(e,t){return""+e.label})).join(" & ")},o=a.drugs.filter((function(e){return e.entries.map((function(e){return!(e.tins&&e.authorization)})).every(Boolean)}));if(!Object(h["isEmpty"])(o)){var c=i(o);return Object(d["e"])("Please fix partial batch entries for drugs: "+c),!1}return!0},options:function(){return e.selectedDrugs},validation:function(e){return s["a"].required(e)}},{id:"reasons",helpText:"Select reason",type:o["b"].TT_SELECT,validation:function(e){return s["a"].required(e)},options:function(t){return e.getReasons(t)}},{id:"summary",helpText:"Summary",type:o["b"].TT_TABLE_VIEWER,options:function(t){return e.buildResults(t)},config:{hiddenFooterBtns:["Clear"]}}]},buildResults:function(e){var t="Relocations"===e.task.value,n=["Drug","Total units","Expiry date","Authorization code"];t&&n.push("Relocation");var r=e.enter_batches.map((function(n){var r=n.value,a=[l["a"].getShortName(r.drug_id),r.tins,u["a"].toStandardHisDisplayFormat(r.expiry),r.authorization];return t&&a.push(e.relocation_location.label),a}));return[{label:"Confirm entry",value:"Table",other:{columns:n,rows:r}}]},prepDrugs:function(e){var t=[],n=this.barcode;return e.enter_batches.value.forEach((function(r){t.push({batch_number:r.batchNumber,items:[{barcode:n,drug_id:r.drugID,expiry_date:r.expiry,quantity:parseInt(r.tabs)*parseInt(r.tins),delivery_date:e.date.value}]})})),t},selectAll:function(e){return e.map((function(e){return e.isChecked=!0,e}))},getItems:function(){return Object(i["b"])(this,void 0,void 0,(function(){var e;return Object(i["d"])(this,(function(t){switch(t.label){case 0:return[4,this.stockService.getItems()];case 1:return e=t.sent(),[2,this.formatDrugs(e)]}}))}))},mapVal:function(e){return e.map((function(e){return{label:e,value:e}}))},getReasons:function(e){return"Relocations"===e.task.value?this.mapVal(["Transfer to another facility/relocation","For trainings"]):this.mapVal(["Expired","Damaged","For trainings"])},formatDrugs:function(e){return e.map((function(e){return{label:l["a"].getShortName(e.drug_id)+" ("+l["a"].getPackSize(e.drug_id)+") Expiry date: "+u["a"].toStandardHisDisplayFormat(e.expiry_date),value:e}}))}},created:function(){this.stockService=new l["a"],this.fields=this.getFields()}}),v=n("d959"),m=n.n(v);const g=m()(p,[["render",a]]);t["default"]=g}}]);
//# sourceMappingURL=chunk-2d0d5c2c.40a776ed.js.map