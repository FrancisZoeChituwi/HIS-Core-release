(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e8890"],{"8a4e":function(e,t,n){"use strict";n.r(t);var r=n("7a23");function i(e,t,n,i,u,a){var o=Object(r["resolveComponent"])("his-standard-form");return Object(r["openBlock"])(),Object(r["createBlock"])(o,{fields:e.fields,activeField:e.activeField,onFinishAction:e.onFinish,skipSummary:!0,onOnIndex:t[1]||(t[1]=function(t){return e.activeField=""}),cancelDestinationPath:e.cancelDestination},null,8,["fields","activeField","onFinishAction","cancelDestinationPath"])}n("a623"),n("4de4"),n("4160"),n("a15b"),n("d81d"),n("45fc"),n("d3b7"),n("159b"),n("ddb0");var u=n("9ab4"),a=n("d95e"),o=n("7920"),c=n("2706"),s=n("9283"),d=n("3d6c"),l=n("b5e4"),f=n("2ef0"),b=Object(r["defineComponent"])({components:{HisStandardForm:o["a"]},data:function(){return{activeField:"",fields:[],drugs:[],selectedDrugs:[],barcode:"",stockService:{}}},methods:{onFinish:function(e){return Object(u["b"])(this,void 0,void 0,(function(){var t,n;return Object(u["d"])(this,(function(r){switch(r.label){case 0:return t=this.prepDrugs(e),[4,this.stockService.postItems(t)];case 1:return n=r.sent(),n?(Object(l["d"])("Stock succesfully added"),this.$router.push("/")):Object(l["c"])("Could not save stock"),[2]}}))}))},getFields:function(){var e=this;return[{id:"barcode",helpText:"Scan barcode",type:a["b"].TT_BARCODE,config:{hiddenFooterBtns:["Clear","Next"]},onValue:function(t){return Object(u["b"])(e,void 0,void 0,(function(){return Object(u["d"])(this,(function(e){return this.barcode=t,this.activeField="select drugs",[2]}))}))}},{id:"select drugs",helpText:"Select drugs",type:a["b"].TT_MULTIPLE_SELECT,requireNext:!0,validation:function(e){return c["a"].required(e)},options:function(){return e.drugs},unload:function(t){return e.selectedDrugs=t},config:{footerBtns:[{name:"Select all",slot:"end",onClick:function(){e.selectAll(e.drugs)}}]}},{id:"date",helpText:"Delivery Date",type:a["b"].TT_FULL_DATE,validation:function(e){return c["a"].required(e)}},{id:"enter_batches",helpText:"Batch entry",type:a["b"].TT_BATCH_ENTRY,options:function(){return e.selectedDrugs},beforeNext:function(e,t,n,r){var i=r.currentFieldContext,u=function(e){return e.map((function(e,t){return""+e.label})).join(" & ")},a=i.drugs.filter((function(e){return e.entries.map((function(e){return!e.tins&&!e.expiry&&!e.batchNumber})).every(Boolean)})),o=i.drugs.filter((function(e){return e.entries.map((function(e){var t=0;return e.tins&&(t+=1),e.expiry&&(t+=1),e.batchNumber&&(t+=1),t>=1&&t<=2})).some(Boolean)}));if(!Object(f["isEmpty"])(o)){var c=u(o);return Object(l["e"])("Please fix partial batch entries for drugs: "+c),!1}if(!Object(f["isEmpty"])(a)){var s=u(a);return Object(l["e"])("The following drug batches are empty: "+s),!1}return!0},validation:function(e){return c["a"].required(e)}},{id:"adherence_report",helpText:"Summary",type:a["b"].TT_TABLE_VIEWER,options:function(t){return e.buildResults(t.enter_batches)},config:{hiddenFooterBtns:["Clear"]}}]},buildResults:function(e){var t=["Drug","Amount per unit","Total units","Expiry date","Batch number"],n=e.map((function(e){var t=e.value;return[t.shortName,t.tabs,t.tins,s["a"].toStandardHisDisplayFormat(t.expiry),t.batchNumber]}));return[{label:"Confirm entry",value:"Table",other:{columns:t,rows:n}}]},prepDrugs:function(e){var t=[],n=this.barcode;return e.enter_batches.forEach((function(r){var i=r.value;t.push({batch_number:i.batchNumber,items:[{barcode:n,drug_id:i.drugID,expiry_date:i.expiry,quantity:parseInt(i.tabs)*parseInt(i.tins),delivery_date:e.date.value}]})})),t},selectAll:function(e){return e.map((function(e){return e.isChecked=!0,e}))},formatDrugs:function(){return this.stockService.drugList().map((function(e){return{label:e.shortName,value:e}}))}},created:function(){this.stockService=new d["a"],this.fields=this.getFields(),this.drugs=this.formatDrugs()}}),h=n("d959"),p=n.n(h);const v=p()(b,[["render",i]]);t["default"]=v}}]);
//# sourceMappingURL=chunk-2d0e8890.e2df7244.js.map